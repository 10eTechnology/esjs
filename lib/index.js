!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ESjs=t():e.ESjs=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(7),o=r(9),s=r(2),u=function(e){return e&&e.__esModule?e:{default:e}}(s),a={run:function(e){return String(e).split(/\s+/)}},l=new RegExp("^"+u.default),c=new RegExp(u.default+"$"),f={run:function(e){return e.reduce(function(e,t){var r=t.replace(l,"").replace(c,"");return r&&e.push(r),e},[])}},d={whitespace:a,strip:f,tokenize:n.StandardTokenizer,stemmer:i.PorterStemmer,stopwords:o.Stopwords},h={run:function(e,t){return t.reduce(function(e,t){return d[t].run(e)},e)}};t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(11);Object.defineProperty(t,"StandardTokenizer",{enumerable:!0,get:function(){return n(i).default}});t.tokenCount=function(e){var t={};return e.forEach(function(e){t[e]||(t[e]=0),t[e]+=1}),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default="[ -⁯⸀-⹿'!\"#$%&()*+,-./:;<=>?@\\[\\]^_`{|}~]"},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(0),u=function(e){return e&&e.__esModule?e:{default:e}}(s),a=Object.keys,l=Object.values,c=Array.isArray,f=function(e){return JSON.parse(JSON.stringify(e))},d=function(){function e(t,r){n(this,e),this.OPERATORS={AND:"and"},this.query=e.normalizeQuery(r),this.idx=t,this.idfCache={},this.filtersOperator=null,this.filtersArray=[],this.registerFilters()}return o(e,null,[{key:"normalizeQuery",value:function(e){return"string"==typeof e?{must:{match:{_all:e}}}:e}},{key:"mergeMatches",value:function(e,t){var r=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach(function(e){r[e]||(r[e]=0),r[e]+=t[e]}),r}},{key:"valueForType",value:function(t,r){var n="raw"===r?"value":"query";return e.valueFromQuery(t,n)}},{key:"valueFromQuery",value:function(e,t){return"string"==typeof e?e:e[t]}}]),o(e,[{key:"registerFilters",value:function(){c(this.query.filter)&&(this.filtersArray=this.query.filter),"object"===i(this.query.filter)&&(this.validateCompoundFilter(),this.filtersOperator=a(this.query.filter)[0],this.filtersArray=l(this.query.filter)[0])}},{key:"validateCompoundFilter",value:function(){var e=a(this.query.filter)[0],t=l(this.OPERATORS).indexOf(e)>-1,r=l(this.query.filter)[0];if(!t||!c(r))throw Error("Invalid query syntax.")}},{key:"search",value:function(){var e=this.filterResults(this.query.matchAll?this.matchAll():this.searchFields(this.query.must)),t=[];return Object.keys(e).forEach(function(r){return t.push({id:r,score:e[r]})}),t.sort(function(e,t){return t.score-e.score}),t}},{key:"searchFields",value:function(t){var r=this,n={};return(Array.isArray(t)?t:[t]).forEach(function(t){Object.keys(t).forEach(function(i){var o=r[i](t[i]);n=e.mergeMatches(n,o)})}),n}},{key:"processANDFilters",value:function(){var t=this,r={};return this.filtersArray.forEach(function(n,i){a(n).forEach(function(o){var s=t[o](n[o]);r=0===i?s:e.intersectMatches(r,s)})}),r}},{key:"getDocsForCompoundFilterQuery",value:function(){var e={};switch(this.filtersOperator){case this.OPERATORS.AND:e=this.processANDFilters()}return e}},{key:"filterResults",value:function(e){if(c(this.filtersArray)&&0===this.filtersArray.length)return e;var t=void 0;t=a(this.filtersOperator?this.getDocsForCompoundFilterQuery():this.searchFields(this.filtersArray));var r={};return a(e).forEach(function(n){-1!==t.indexOf(n)&&(r[n]=e[n])}),r}},{key:"matchAll",value:function(){var e={};return Object.keys(this.idx.docs).forEach(function(t){e[t]=1}),e}},{key:"match",value:function(e){return this.matchOnIndex(e,"tokenized")}},{key:"term",value:function(e){return this.matchOnIndex(e,"raw")}},{key:"matchOnIndex",value:function(t,r){var n=this,i={},o=this.fieldsFromQuery(t,r);return Object.keys(o).forEach(function(t){var s=n.matchField(t,o[t],r);i=e.mergeMatches(i,s)}),i}},{key:"matchField",value:function(e,t,r){var n=this,i={};return t.tokens.forEach(function(o){var s=n.idx.getNode(e,o,r);s&&Object.keys(s.docs).forEach(function(r){i[r]=n.scoreDoc({id:r,token:o,field:e,query:t,df:s.df,tf:s.docs[r].tf})})}),i}},{key:"scoreDoc",value:function(e){return this.idf(e)*this.fieldNorm(e)*e.tf*e.query.boost}},{key:"idf",value:function(e){var t=e.field+"/"+e.token;if(!this.idfCache[t]){var r=this.idx.docCount(),n=e.df,i=1+Math.log(r/(n+1));this.idfCache[t]=i}return this.idfCache[t]}},{key:"fieldNorm",value:function(e){var t=this.idx.getDoc(e.id),r=t[e.field]?t[e.field].size:0;return 0===r?1:1/Math.sqrt(r)}},{key:"boostFromQuery",value:function(e,t){return"object"===(void 0===t?"undefined":i(t))&&t.boost?t.boost:this.idx.fieldBoost(e)}},{key:"pipelineForType",value:function(e){return"raw"===e?this.idx.pipesForTerms():this.idx.pipesForTokens()}},{key:"tokenize",value:function(e,t){var r=this.pipelineForType(t);return u.default.run(e,r)}},{key:"fieldsFromQuery",value:function(t,r){var n=this;if(t._all)return this.allFieldsQuery(t._all,r);var i={};return Object.keys(t).forEach(function(o){var s=e.valueForType(t[o],r),u=n.boostFromQuery(o,t[o]),a=n.tokenize(s,r);i[o]={tokens:a,boost:u}}),i}},{key:"allFieldsQuery",value:function(t,r){var n=this,i={},o=e.valueForType(t,r),s=this.tokenize(o,r);return Object.keys(this.idx.fields).forEach(function(e){var r=n.boostFromQuery(e,t);i[e]={tokens:s,boost:r}}),i}}],[{key:"intersectMatches",value:function(e,t){var r=f(e);return a(e).forEach(function(e){t[e]||delete r[e]}),r}}]),e}();t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={serialize:function(e){return JSON.stringify({version:"1.0",fields:e.fields,docs:e.docs,index:e.index})},deserialize:function(e){var t=JSON.parse(e);if("1.0"!==t.version)throw new Error("Can't deserialize from version "+t.version);return t}};t.default=n},function(e,t,r){"use strict";!function(){function e(e){var t,s,f,d,h,y,v;if(e.length<3)return e;if(f=e.substr(0,1),"y"==f&&(e=f.toUpperCase()+e.substr(1)),d=/^(.+?)(ss|i)es$/,h=/^(.+?)([^s])s$/,d.test(e)?e=e.replace(d,"$1$2"):h.test(e)&&(e=e.replace(h,"$1$2")),d=/^(.+?)eed$/,h=/^(.+?)(ed|ing)$/,d.test(e)){var p=d.exec(e);d=new RegExp(u),d.test(p[1])&&(d=/.$/,e=e.replace(d,""))}else if(h.test(e)){var p=h.exec(e);t=p[1],h=new RegExp(c),h.test(t)&&(e=t,h=/(at|bl|iz)$/,y=new RegExp("([^aeiouylsz])\\1$"),v=new RegExp("^"+o+i+"[^aeiouwxy]$"),h.test(e)?e+="e":y.test(e)?(d=/.$/,e=e.replace(d,"")):v.test(e)&&(e+="e"))}if(d=/^(.+?)y$/,d.test(e)){var p=d.exec(e);t=p[1],d=new RegExp(c),d.test(t)&&(e=t+"i")}if(d=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,d.test(e)){var p=d.exec(e);t=p[1],s=p[2],d=new RegExp(u),d.test(t)&&(e=t+r[s])}if(d=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,d.test(e)){var p=d.exec(e);t=p[1],s=p[2],d=new RegExp(u),d.test(t)&&(e=t+n[s])}if(d=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,h=/^(.+?)(s|t)(ion)$/,d.test(e)){var p=d.exec(e);t=p[1],d=new RegExp(l),d.test(t)&&(e=t)}else if(h.test(e)){var p=h.exec(e);t=p[1]+p[2],h=new RegExp(l),h.test(t)&&(e=t)}if(d=/^(.+?)e$/,d.test(e)){var p=d.exec(e);t=p[1],d=new RegExp(l),h=new RegExp(a),y=new RegExp("^"+o+i+"[^aeiouwxy]$"),(d.test(t)||h.test(t)&&!y.test(t))&&(e=t)}return d=/ll$/,h=new RegExp(l),d.test(e)&&h.test(e)&&(d=/.$/,e=e.replace(d,"")),"y"==f&&(e=f.toLowerCase()+e.substr(1)),e}var r={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},n={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},i="[aeiouy]",o="[^aeiou][^aeiouy]*",s=i+"[aeiou]*",u="^("+o+")?"+s+o,a="^("+o+")?"+s+o+"("+s+")?$",l="^("+o+")?"+s+o+s+o,c="^("+o+")?"+i,f={},d=function(t){return f[t]||(f[t]=e(t)),f[t]};void 0!==t&&null!=t&&(t.stemmer=e,t.memoizingStemmer=d)}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(0),u=n(s),a=r(4),l=n(a),c=r(1),f=r(3),d=n(f),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i(this,e),this.fields=t?t.fields:{},this.docs={},this.index={tokenized:{},raw:{}},this.storeDocs=!!t&&t.storeDocs,this.allowPartial=!!t&&t.allowPartial,this.stopwords=!t||t.stopwords,r&&this.deserialize(r)}return o(e,[{key:"serialize",value:function(){return l.default.serialize(this)}},{key:"deserialize",value:function(e){var t=l.default.deserialize(e);this.fields=t.fields,this.docs=t.docs,this.index=t.index}},{key:"addDocs",value:function(e){var t=this;e.forEach(function(e){return t.addDoc(e)})}},{key:"addDoc",value:function(e){if(!e.id)throw new Error("documents must have an id attribute");this.storeDoc(e),this.indexDoc(e)}},{key:"search",value:function(e){var t=new d.default(this,e).search();return this.storeDocs?this.hydrateResults(t):t}},{key:"hydrateResults",value:function(e){var t=this;return e.map(function(e){return{id:e.id,score:e.score,doc:t.docs[e.id].doc}})}},{key:"storeDoc",value:function(e){this.docs[e.id]={},this.storeDocs&&(this.docs[e.id].doc=JSON.parse(JSON.stringify(e)))}},{key:"updateDocFieldLength",value:function(e,t,r){this.docs[e.id][t]||(this.docs[e.id][t]={}),this.docs[e.id][t].size=r}},{key:"indexDoc",value:function(e){var t=this;Object.keys(this.fields).forEach(function(r){t.indexField(r,e)})}},{key:"ensureFieldIndex",value:function(e){var t=this;["tokenized","raw"].forEach(function(r){t.index[r][e]||(t.index[r][e]={})})}},{key:"indexField",value:function(e,t){t[e]&&(this.ensureFieldIndex(e),this.addTokens(t,e),this.addTerms(t,e))}},{key:"pipesForTokens",value:function(){var e=this;return["whitespace","strip","tokenize","stopwords","stemmer"].filter(function(t){return e.stopwords||"stopwords"!==t})}},{key:"addTokens",value:function(e,t){var r=this.pipesForTokens(t),n=u.default.run(e[t],r);this.updateDocFieldLength(e,t,n.length),this.addTokensWithCounts(e,t,n)}},{key:"pipesForTerms",value:function(){var e=this;return["whitespace","strip","stopwords"].filter(function(t){return e.stopwords||"stopwords"!==t})}},{key:"addTerms",value:function(e,t){var r=this.pipesForTerms(t),n=u.default.run(e[t],r);this.addTokensWithCounts(e,t,n,"raw")}},{key:"addTokensWithCounts",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"tokenized",o=(0,c.tokenCount)(r);Object.keys(o).forEach(function(r){var s=Math.sqrt(o[r]);n.addToken(t,r,{id:e.id,tf:s},i)})}},{key:"addToken",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"tokenized";this.allowPartial&&this.addTokenSubstrings(e,t,r,n),this.addTokenToNode(e,t,r,n)}},{key:"addTokenSubstrings",value:function(e,t,r,n){for(var i=1;i<t.length;i+=1){var o=t.substr(0,i);this.addTokenToNode(e,o,{id:r.id,tf:Math.sqrt(r.tf/o.length)},n)}}},{key:"addTokenToNode",value:function(e,t,r,n){var i=this.getNode(e,t,n,!0);i.docs[r.id]?i.docs[r.id].tf=r.tf:(i.docs[r.id]={tf:r.tf},i.df+=1)}},{key:"fieldBoost",value:function(e){return this.fields[e]&&this.fields[e].boost?this.fields[e].boost:1}},{key:"docCount",value:function(){return Object.keys(this.docs).length}},{key:"getDoc",value:function(e){return this.docs[e]}},{key:"getNode",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"tokenized",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=0,o=this.index[r][e];if(!o)return null;for(;i<t.length;){var s=t[i];if(!(s in o)){if(!n)return null;o[s]={docs:{},df:0}}i+=1,o=o[s]}return o}}]),e}();t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(8);Object.defineProperty(t,"PorterStemmer",{enumerable:!0,get:function(){return n(i).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),i={run:function(e){return e.map(function(e){return(0,n.stemmer)(e)})}};t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stopwords=void 0;var n=r(10),i=function(e){return e&&e.__esModule?e:{default:e}}(n);t.Stopwords={run:function(e){return e.filter(function(e){return-1===i.default.indexOf(e)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["a","about","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","computer","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fify","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","i","ie","if","in","inc","indeed","interest","into","is","it","its","itse","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","the","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thick","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves"];t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(e){return e&&e.__esModule?e:{default:e}}(n),o=new RegExp(i.default,"g"),s={run:function(e){return e.reduce(function(e,t){var r=t.replace(o," ").toLowerCase().split(/\s+/).filter(function(e){return!!e});return r.length>0?e.concat(r):e},[])}};t.default=s}])});