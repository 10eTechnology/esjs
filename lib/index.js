!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ESjs=t():e.ESjs=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=13)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(14),i=n(16),u=n(2),s=function(e){return e&&e.__esModule?e:{default:e}}(u),a={run:function(e){return String(e).split(/\s+/)}},l=new RegExp("^"+s.default),f=new RegExp(s.default+"$"),c={run:function(e){return e.reduce(function(e,t){var n=t.replace(l,"").replace(f,"");return n&&e.push(n),e},[])}},d={whitespace:a,strip:c,tokenize:r.StandardTokenizer,stemmer:o.PorterStemmer,stopwords:i.Stopwords},h={run:function(e,t){return t.reduce(function(e,t){return d[t].run(e)},e)}};t.default=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(18);Object.defineProperty(t,"StandardTokenizer",{enumerable:!0,get:function(){return r(o).default}});t.tokenCount=function(e){var t={};return e.forEach(function(e){t[e]||(t[e]=0),t[e]+=1}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default="[ -⁯⸀-⹿'!\"#$%&()*+,-./:;<=>?@\\[\\]^_`{|}~]"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=void 0;var r=n(7),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.normalize=o.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),s=function(e){return e&&e.__esModule?e:{default:e}}(u),a=function(){function e(t,n){r(this,e),this.query=e.normalizeQuery(n),this.idx=t,this.idfCache={}}return i(e,null,[{key:"normalizeQuery",value:function(e){return"string"==typeof e?{must:{match:{_all:e}}}:e}},{key:"mergeMatches",value:function(e,t){var n=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach(function(e){n[e]||(n[e]=0),n[e]+=t[e]}),n}},{key:"valueForType",value:function(t,n){var r="raw"===n?"value":"query";return e.valueFromQuery(t,r)}},{key:"valueFromQuery",value:function(e,t){return"string"==typeof e?e:e[t]}}]),i(e,[{key:"search",value:function(){var e=this.filterResults(this.query.matchAll?this.matchAll():this.searchFields(this.query.must)),t=[];return Object.keys(e).forEach(function(n){return t.push({id:n,score:e[n]})}),t.sort(function(e,t){return t.score-e.score}),t}},{key:"searchFields",value:function(t){var n=this,r={};return(Array.isArray(t)?t:[t]).forEach(function(t){Object.keys(t).forEach(function(o){var i=n[o](t[o]);r=e.mergeMatches(r,i)})}),r}},{key:"filterResults",value:function(e){var t=this;if(!this.query.filter)return e;if(Array.isArray(this.query.filter)&&0===this.query.filter.length)return e;var n=Object.keys(e);if(0===n.length)return e;var r=Array.isArray(this.query.filter)?this.query.filter:[this.query.filter],o=Object.assign({},e);return r.forEach(function(e){Object.keys(e).forEach(function(r){var i=t[r](e[r]);n.forEach(function(e){void 0===i[e]&&delete o[e]})})}),o}},{key:"matchAll",value:function(){var e={};return Object.keys(this.idx.docs).forEach(function(t){e[t]=1}),e}},{key:"match",value:function(e){return this.matchOnIndex(e,"tokenized")}},{key:"term",value:function(e){return this.matchOnIndex(e,"raw")}},{key:"matchOnIndex",value:function(t,n){var r=this,o={},i=this.fieldsFromQuery(t,n);return Object.keys(i).forEach(function(t){var u=r.matchField(t,i[t],n);o=e.mergeMatches(o,u)}),o}},{key:"matchField",value:function(e,t,n){var r=this,o={};return t.tokens.forEach(function(i){var u=r.idx.getNode(e,i,n);u&&Object.keys(u.docs).forEach(function(n){o[n]=r.scoreDoc({id:n,token:i,field:e,query:t,df:u.df,tf:u.docs[n].tf})})}),o}},{key:"scoreDoc",value:function(e){return this.idf(e)*this.fieldNorm(e)*e.tf*e.query.boost}},{key:"idf",value:function(e){var t=e.field+"/"+e.token;if(!this.idfCache[t]){var n=this.idx.docCount(),r=e.df,o=1+Math.log(n/(r+1));this.idfCache[t]=o}return this.idfCache[t]}},{key:"fieldNorm",value:function(e){var t=this.idx.getDoc(e.id),n=t[e.field]?t[e.field].size:0;return 0===n?1:1/Math.sqrt(n)}},{key:"boostFromQuery",value:function(e,t){return"object"===(void 0===t?"undefined":o(t))&&t.boost?t.boost:this.idx.fieldBoost(e)}},{key:"pipelineForType",value:function(e){return"raw"===e?this.idx.pipesForTerms():this.idx.pipesForTokens()}},{key:"tokenize",value:function(e,t){var n=this.pipelineForType(t);return s.default.run(e,n)}},{key:"fieldsFromQuery",value:function(t,n){var r=this;if(t._all)return this.allFieldsQuery(t._all,n);var o={};return Object.keys(t).forEach(function(i){var u=e.valueForType(t[i],n),s=r.boostFromQuery(i,t[i]),a=r.tokenize(u,n);o[i]={tokens:a,boost:s}}),o}},{key:"allFieldsQuery",value:function(t,n){var r=this,o={},i=e.valueForType(t,n),u=this.tokenize(i,n);return Object.keys(this.idx.fields).forEach(function(e){var n=r.boostFromQuery(e,t);o[e]={tokens:u,boost:n}}),o}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={serialize:function(e){return JSON.stringify({version:"1.0",fields:e.fields,docs:e.docs,index:e.index})},deserialize:function(e){var t=JSON.parse(e);if("1.0"!==t.version)throw new Error("Can't deserialize from version "+t.version);return t}};t.default=r},function(e,t,n){"use strict";!function(){function e(e){var t,u,c,d,h,y,v;if(e.length<3)return e;if(c=e.substr(0,1),"y"==c&&(e=c.toUpperCase()+e.substr(1)),d=/^(.+?)(ss|i)es$/,h=/^(.+?)([^s])s$/,d.test(e)?e=e.replace(d,"$1$2"):h.test(e)&&(e=e.replace(h,"$1$2")),d=/^(.+?)eed$/,h=/^(.+?)(ed|ing)$/,d.test(e)){var p=d.exec(e);d=new RegExp(s),d.test(p[1])&&(d=/.$/,e=e.replace(d,""))}else if(h.test(e)){var p=h.exec(e);t=p[1],h=new RegExp(f),h.test(t)&&(e=t,h=/(at|bl|iz)$/,y=new RegExp("([^aeiouylsz])\\1$"),v=new RegExp("^"+i+o+"[^aeiouwxy]$"),h.test(e)?e+="e":y.test(e)?(d=/.$/,e=e.replace(d,"")):v.test(e)&&(e+="e"))}if(d=/^(.+?)y$/,d.test(e)){var p=d.exec(e);t=p[1],d=new RegExp(f),d.test(t)&&(e=t+"i")}if(d=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,d.test(e)){var p=d.exec(e);t=p[1],u=p[2],d=new RegExp(s),d.test(t)&&(e=t+n[u])}if(d=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,d.test(e)){var p=d.exec(e);t=p[1],u=p[2],d=new RegExp(s),d.test(t)&&(e=t+r[u])}if(d=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,h=/^(.+?)(s|t)(ion)$/,d.test(e)){var p=d.exec(e);t=p[1],d=new RegExp(l),d.test(t)&&(e=t)}else if(h.test(e)){var p=h.exec(e);t=p[1]+p[2],h=new RegExp(l),h.test(t)&&(e=t)}if(d=/^(.+?)e$/,d.test(e)){var p=d.exec(e);t=p[1],d=new RegExp(l),h=new RegExp(a),y=new RegExp("^"+i+o+"[^aeiouwxy]$"),(d.test(t)||h.test(t)&&!y.test(t))&&(e=t)}return d=/ll$/,h=new RegExp(l),d.test(e)&&h.test(e)&&(d=/.$/,e=e.replace(d,"")),"y"==c&&(e=c.toLowerCase()+e.substr(1)),e}var n={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},r={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},o="[aeiouy]",i="[^aeiou][^aeiouy]*",u=o+"[aeiou]*",s="^("+i+")?"+u+i,a="^("+i+")?"+u+i+"("+u+")?$",l="^("+i+")?"+u+i+u+i,f="^("+i+")?"+o,c={},d=function(t){return c[t]||(c[t]=e(t)),c[t]};void 0!==t&&null!=t&&(t.stemmer=e,t.memoizingStemmer=d)}()},function(e,t,n){"use strict";function r(e){return Object.keys(u).reduce(function(t,n){var r=e[n],o=u[n];if(void 0===r&&Object.prototype.hasOwnProperty.call(o,"default")&&(r=o.default),!o.validate(r))throw new Error("Invalid value given for '"+n+"', "+r);return t[n]=r,t},{})}Object.defineProperty(t,"__esModule",{value:!0}),t.configValidatorMap=void 0,t.default=r;var o=n(9),i=function(e){return e&&e.__esModule?e:{default:e}}(o),u=t.configValidatorMap={fields:{validate:i.default.shape({"*":i.default.oneOf([i.default.shape({boost:i.default.number,analyzer:i.default.oneOf(["keyword","standard"])}),null])}),default:{}},storeDocs:{validate:i.default.bool,default:!1},allowPartial:{validate:i.default.bool,default:!1},stopwords:{validate:i.default.bool,default:!1}}},function(e,t,n){"use strict";function r(e){return"boolean"==typeof e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),i=r(o),u=n(8),s=r(u),a=n(12),l=r(a),f=n(10),c=r(f);t.default={oneOf:i.default,bool:s.default,shape:l.default,number:c.default}},function(e,t,n){"use strict";function r(e){return"number"==typeof e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";function r(e){if(!Array.isArray(e))throw new Error("oneOf must be given an array of options. "+(void 0===e?"undefined":o(e))+" given");return function(t){return e.some(function(e){return"function"==typeof e?e(t):e===t})}}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=r},function(e,t,n){"use strict";function r(e){if("object"!==(void 0===e?"undefined":o(e))||null===e)throw new Error("Shape validator config expected an object. \n      "+(void 0===e?"undefined":o(e))+" given");return Object.keys(e).forEach(function(t){if("function"!=typeof e[t])throw new Error("Invalid validator function given for "+t)}),function(t){return"object"===(void 0===t?"undefined":o(t))&&null!==t&&Object.keys(e).every(function(n){var r=e[n];return"*"===n?Object.values(t).every(function(e){return r(e)}):!Object.prototype.hasOwnProperty.call(t,n)||r(t[n])})}}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),s=r(u),a=n(5),l=r(a),f=n(1),c=n(4),d=r(c),h=n(3),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o(this,e);var r=(0,h.normalize)(t);this.fields=r.fields,this.docs={},this.docIdToIndexNodeMap={},this.index={tokenized:{},raw:{}},this.storeDocs=r.storeDocs,this.allowPartial=r.allowPartial,this.stopwords=r.stopwords,n&&this.deserialize(n)}return i(e,[{key:"serialize",value:function(){return l.default.serialize(this)}},{key:"deserialize",value:function(e){var t=l.default.deserialize(e);this.fields=t.fields,this.docs=t.docs,this.index=t.index}},{key:"addDocs",value:function(e){var t=this;e.forEach(function(e){return t.addDoc(e)})}},{key:"addDoc",value:function(e){if(!e.id)throw new Error("documents must have an id attribute");this.storeDoc(e),this.indexDoc(e)}},{key:"removeDoc",value:function(e){e in this.docs&&(this.removeDocFromIndexTree(e),delete this.docs[e],delete this.docIdToIndexNodeMap[e])}},{key:"search",value:function(e){var t=new d.default(this,e).search();return this.storeDocs?this.hydrateResults(t):t}},{key:"hydrateResults",value:function(e){var t=this;return e.map(function(e){return{id:e.id,score:e.score,doc:t.docs[e.id].doc}})}},{key:"storeDoc",value:function(e){e.id in this.docs&&this.removeDoc(e.id),this.docs[e.id]={},this.storeDocs&&(this.docs[e.id].doc=JSON.parse(JSON.stringify(e)))}},{key:"updateDocFieldLength",value:function(e,t,n){this.docs[e.id][t]||(this.docs[e.id][t]={}),this.docs[e.id][t].size=n}},{key:"indexDoc",value:function(e){var t=this;Object.keys(this.fields).forEach(function(n){t.indexField(n,e)})}},{key:"ensureFieldIndex",value:function(e){var t=this;["tokenized","raw"].forEach(function(n){t.index[n][e]||(t.index[n][e]={})})}},{key:"indexField",value:function(e,t){var n=this;if(t[e]){this.ensureFieldIndex(e);var r="standard";this.fields[e]&&this.fields[e].analyzer&&(r=this.fields[e].analyzer);({keyword:[this.addTerms],standard:[this.addTokens,this.addTerms]})[r].forEach(function(r){return r.call(n,t,e)})}}},{key:"pipesForTokens",value:function(){var e=this;return["whitespace","strip","tokenize","stopwords","stemmer"].filter(function(t){return e.stopwords||"stopwords"!==t})}},{key:"addTokens",value:function(e,t){var n=this.pipesForTokens(t),r=s.default.run(e[t],n);this.updateDocFieldLength(e,t,r.length),this.addTokensWithCounts(e,t,r)}},{key:"pipesForTerms",value:function(){var e=this;return["whitespace","strip","stopwords"].filter(function(t){return e.stopwords||"stopwords"!==t})}},{key:"addTerms",value:function(e,t){var n=this.pipesForTerms(t),r=s.default.run(e[t],n);this.addTokensWithCounts(e,t,r,"raw")}},{key:"addTokensWithCounts",value:function(e,t,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"tokenized",i=(0,f.tokenCount)(n);Object.keys(i).forEach(function(n){var u=Math.sqrt(i[n]);r.addToken(t,n,{id:e.id,tf:u},o)})}},{key:"addToken",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"tokenized";this.allowPartial&&this.addTokenSubstrings(e,t,n,r),this.addTokenToNode(e,t,n,r)}},{key:"addTokenSubstrings",value:function(e,t,n,r){for(var o=1;o<t.length;o+=1){var i=t.substr(0,o);this.addTokenToNode(e,i,{id:n.id,tf:Math.sqrt(n.tf/i.length)},r)}}},{key:"addTokenToNode",value:function(e,t,n,r){var o=this.getNode(e,t,r,!0);o.docs[n.id]?o.docs[n.id].tf=n.tf:(o.docs[n.id]={tf:n.tf},o.df+=1,n.id in this.docIdToIndexNodeMap||(this.docIdToIndexNodeMap[n.id]=[]),this.docIdToIndexNodeMap[n.id].push(o))}},{key:"fieldBoost",value:function(e){return this.fields[e]&&this.fields[e].boost?this.fields[e].boost:1}},{key:"docCount",value:function(){return Object.keys(this.docs).length}},{key:"getDoc",value:function(e){return this.docs[e]}},{key:"removeDocFromIndexTree",value:function(t){t in this.docIdToIndexNodeMap&&this.docIdToIndexNodeMap[t].forEach(function(n){e.removeDocFromNode(t,n)})}},{key:"getNode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"tokenized",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=0,i=this.index[n][e];if(!i)return null;for(;o<t.length;){var u=t[o];if(!(u in i)){if(!r)return null;i[u]={docs:{},df:0}}o+=1,i=i[u]}return i}}],[{key:"removeDocFromNode",value:function(e,t){t&&t.docs&&delete t.docs[e]}}]),e}();t.default=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(15);Object.defineProperty(t,"PorterStemmer",{enumerable:!0,get:function(){return r(o).default}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o={run:function(e){return e.map(function(e){return(0,r.stemmer)(e)})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stopwords=void 0;var r=n(17),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.Stopwords={run:function(e){return e.filter(function(e){return-1===o.default.indexOf(e)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["a","about","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","computer","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fify","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","i","ie","if","in","inc","indeed","interest","into","is","it","its","itse","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","the","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thick","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves"];t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i=new RegExp(o.default,"g"),u={run:function(e){return e.reduce(function(e,t){var n=t.replace(i," ").toLowerCase().split(/\s+/).filter(function(e){return!!e});return n.length>0?e.concat(n):e},[])}};t.default=u}])});